import{ac as V,af as bt,a1 as G,ap as wt,aq as Ct,ar as Tt,a0 as It,as as St,T as U,D as _t,a5 as Wt,at as Mt,au as Ot,d as Et,l as At,w as L,i as Rt,f as R,O as H,j as q,a2 as Pt}from"./index-fc527e32.js";import{c as j,g as Lt}from"./_commonjsHelpers.187a63f9.js";import{r as Ht}from"./use-router.313bd280.js";import{_ as Dt}from"./_plugin-vue_export-helper.c27b6911.js";var $={exports:{}};(function(g,I){(function(y,_){g.exports=_()})(j,function(){var y=void 0,_=["touchstarted","touchmoved","touchended"],w={strokeStyle:"setStrokeStyle",fillStyle:"setFillStyle",lineWidth:"setLineWidth"};function W(t){return t.charAt(0).toUpperCase()+t.slice(1)}function M(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];_.forEach(function(i,a){e[a]!==void 0&&(t[i]=e[a])})}function O(t,e){Object.defineProperties(t,e)}function D(){return y||(y=V()),y}function F(t,e,r){t.type==="2d"?t.ctx[e]=r:t.ctx[w[e]](r)}var d={},Z=D(),J=Z.pixelRatio,B={id:{default:"cropper",get:function(){return d.id},set:function(e){typeof e!="string"&&console.error("id："+e+" is invalid"),d.id=e}},width:{default:750,get:function(){return d.width},set:function(e){typeof e!="number"&&console.error("width："+e+" is invalid"),d.width=e}},height:{default:750,get:function(){return d.height},set:function(e){typeof e!="number"&&console.error("height："+e+" is invalid"),d.height=e}},pixelRatio:{default:J,get:function(){return d.pixelRatio},set:function(e){typeof e!="number"&&console.error("pixelRatio："+e+" is invalid"),d.pixelRatio=e}},scale:{default:2.5,get:function(){return d.scale},set:function(e){typeof e!="number"&&console.error("scale："+e+" is invalid"),d.scale=e}},zoom:{default:5,get:function(){return d.zoom},set:function(e){typeof e!="number"?console.error("zoom："+e+" is invalid"):(e<0||e>10)&&console.error("zoom should be ranged in 0 ~ 10"),d.zoom=e}},src:{default:"",get:function(){return d.src},set:function(e){typeof e!="string"&&console.error("src："+e+" is invalid"),d.src=e}},cut:{default:{},get:function(){return d.cut},set:function(e){typeof e!="object"&&console.error("cut："+e+" is invalid"),d.cut=e}},boundStyle:{default:{},get:function(){return d.boundStyle},set:function(e){typeof e!="object"&&console.error("boundStyle："+e+" is invalid"),d.boundStyle=e}},onReady:{default:null,get:function(){return d.ready},set:function(e){d.ready=e}},onBeforeImageLoad:{default:null,get:function(){return d.beforeImageLoad},set:function(e){d.beforeImageLoad=e}},onImageLoad:{default:null,get:function(){return d.imageLoad},set:function(e){d.imageLoad=e}},onBeforeDraw:{default:null,get:function(){return d.beforeDraw},set:function(e){d.beforeDraw=e}}},K=D(),Q=K.windowWidth;function tt(){var t=this;t.attachPage=function(){var e=bt(),r=e[e.length-1];Object.defineProperty(r,"wecropper",{get:function(){return console.warn(`Instance will not be automatically bound to the page after v1.4.0

Please use a custom instance name instead

Example: 
this.mycropper = new WeCropper(options)

// ...
this.mycropper.getCropperImage()`),t},configurable:!0})},t.createCtx=function(){var e=t.id,r=t.targetId;e?(t.ctx=t.ctx||G(e),t.targetCtx=t.targetCtx||G(r),typeof t.ctx.setStrokeStyle!="function"&&(t.type="2d")):console.error("constructor: create canvas context failed, 'id' must be valuable")},t.deviceRadio=Q/750}var E=function(t){return typeof t=="function"},et=["ready","beforeImageLoad","beforeDraw","imageLoad"];function rt(){var t=this;t.on=function(e,r){return et.indexOf(e)>-1?E(r)&&(e==="ready"?r(t):t["on"+W(e)]=r):console.error("event: "+e+" is invalid"),t}}function z(t){return function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];return e===void 0&&(e={}),new Promise(function(a,o){e.success=function(n){a(n)},e.fail=function(n){o(n)},t.apply(void 0,[e].concat(r))})}}function N(t,e){return e===void 0&&(e=!1),new Promise(function(r){t.draw&&t.draw(e,r)})}var ot=z(wt),at=z(Ct),it=function(t,e){return new Promise(function(r,i){if(t.type==="2d"){var a=t.canvas.createImage();a.onload=function(){r(a)},a.onerror=function(o){i(o)},a.src=e}else r(e)})},k=typeof window!="undefined"?window:typeof j!="undefined"?j:typeof self!="undefined"?self:{};function nt(t,e){return e={exports:{}},t(e,e.exports),e.exports}var ct=nt(function(t,e){/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(r){var i=e,a=t&&t.exports==i&&t,o=typeof k=="object"&&k;(o.global===o||o.window===o)&&(r=o);var n=function(c){this.message=c};n.prototype=new Error,n.prototype.name="InvalidCharacterError";var h=function(c){throw new n(c)},f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=/[\t\n\f\r ]/g,m=function(c){c=String(c).replace(l,"");var p=c.length;p%4==0&&(c=c.replace(/==?$/,""),p=c.length),(p%4==1||/[^+a-zA-Z0-9/]/.test(c))&&h("Invalid character: the string to be decoded is not correctly encoded.");for(var x=0,v,C,A="",P=-1;++P<p;)C=f.indexOf(c.charAt(P)),v=x%4?v*64+C:C,x++%4&&(A+=String.fromCharCode(255&v>>(-2*x&6)));return A},u=function(c){c=String(c),/[^\0-\xFF]/.test(c)&&h("The string to be encoded contains characters outside of the Latin1 range.");for(var p=c.length%3,x="",v=-1,C,A,P,T,yt=c.length-p;++v<yt;)C=c.charCodeAt(v)<<16,A=c.charCodeAt(++v)<<8,P=c.charCodeAt(++v),T=C+A+P,x+=f.charAt(T>>18&63)+f.charAt(T>>12&63)+f.charAt(T>>6&63)+f.charAt(T&63);return p==2?(C=c.charCodeAt(v)<<8,A=c.charCodeAt(++v),T=C+A,x+=f.charAt(T>>10)+f.charAt(T>>4&63)+f.charAt(T<<2&63)+"="):p==1&&(T=c.charCodeAt(v),x+=f.charAt(T>>2)+f.charAt(T<<4&63)+"=="),x},s={encode:u,decode:m,version:"0.1.0"};if(i&&!i.nodeType)if(a)a.exports=s;else for(var b in s)s.hasOwnProperty(b)&&(i[b]=s[b]);else r.base64=s})(k)});function st(t,e){return"data:"+e+";base64,"+t}function ht(t){t=t.toLowerCase().replace(/jpg/i,"jpeg");var e=t.match(/png|jpeg|bmp|gif/)[0];return"image/"+e}function X(t){var e="";if(typeof t=="string")e=t;else for(var r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return ct.encode(e)}function ft(t,e,r,i,a,o){Tt({canvasId:t,x:e,y:r,width:i,height:a,success:function(h){o(h,null)},fail:function(h){o(null,h)}})}function dt(t){var e=t.width,r=t.height,i=e*r*3,a=i+54,o=[66,77,a&255,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,54,0,0,0],n=[40,0,0,0,e&255,e>>8&255,e>>16&255,e>>24&255,r&255,r>>8&255,r>>16&255,r>>24&255,1,0,24,0,0,0,0,0,i&255,i>>8&255,i>>16&255,i>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=(4-e*3%4)%4,f=t.data,l="",m=e<<2,u=r,s=String.fromCharCode;do{for(var b=m*(u-1),c="",p=0;p<e;p++){var x=p<<2;c+=s(f[b+x+2])+s(f[b+x+1])+s(f[b+x])}for(var v=0;v<h;v++)c+=String.fromCharCode(0);l+=c}while(--u);var C=X(o.concat(n))+X(l);return C}function Y(t,e,r,i,a,o,n){n===void 0&&(n=function(){}),o===void 0&&(o="png"),o=ht(o),/bmp/.test(o)?ft(t,e,r,i,a,function(h,f){var l=dt(h);E(n)&&n(st(l,"image/"+o),f)}):console.error("暂不支持生成'"+o+"'类型的base64图片")}var ut={convertToImage:Y,convertToBMP:function(t,e){t===void 0&&(t={});var r=t.canvasId,i=t.x,a=t.y,o=t.width,n=t.height;return e===void 0&&(e=function(){}),Y(r,i,a,o,n,"bmp",e)}};function lt(){var t=this,e=t.width,r=t.height,i=t.id,a=t.targetId,o=t.pixelRatio,n=t.cut,h=n.x;h===void 0&&(h=0);var f=n.y;f===void 0&&(f=0);var l=n.width;l===void 0&&(l=e);var m=n.height;m===void 0&&(m=r),t.updateCanvas=function(u){return t.croperTarget&&t.ctx.drawImage(t.croperTarget,t.imgLeft,t.imgTop,t.scaleWidth,t.scaleHeight),E(t.onBeforeDraw)&&t.onBeforeDraw(t.ctx,t),t.setBoundStyle(t.boundStyle),t.type!=="2d"&&t.ctx.draw(!1,u),u&&u(),t},t.pushOrigin=t.pushOrign=function(u){return t.src=u,E(t.onBeforeImageLoad)&&t.onBeforeImageLoad(t.ctx,t),it(t,u).then(function(s){return t.croperTarget=s,ot({src:u}).then(function(b){var c=b.width/b.height,p=l/m;return c<p?(t.rectX=h,t.baseWidth=l,t.baseHeight=l/c,t.rectY=f-Math.abs((m-t.baseHeight)/2)):(t.rectY=f,t.baseWidth=m*c,t.baseHeight=m,t.rectX=h-Math.abs((l-t.baseWidth)/2)),t.imgLeft=t.rectX,t.imgTop=t.rectY,t.scaleWidth=t.baseWidth,t.scaleHeight=t.baseHeight,t.update(),new Promise(function(x){t.updateCanvas(x)})}).then(function(){E(t.onImageLoad)&&t.onImageLoad(t.ctx,t)})})},t.removeImage=function(){return t.src="",t.croperTarget="",t.type==="2d"?t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height):N(t.ctx)},t.getCropperBase64=function(u){u===void 0&&(u=function(){}),ut.convertToBMP({canvasId:i,x:h,y:f,width:l,height:m},u)},t.getCropperImage=function(u,s){var b=Object.assign({fileType:"jpg"},u),c=E(u)?u:E(s)?s:null,p={canvasId:i,x:h,y:f,width:l,height:m};t.type==="2d"&&(p.canvas=t.canvas);var x=function(){return Promise.resolve()};return b.original&&(x=function(){return t.targetCtx.drawImage(t.croperTarget,t.imgLeft*o,t.imgTop*o,t.scaleWidth*o,t.scaleHeight*o),p={canvasId:a,x:h*o,y:f*o,width:l*o,height:m*o},N(t.targetCtx)}),x().then(function(){Object.assign(p,b);var v=p.componentContext?[p,p.componentContext]:[p];return at.apply(null,v)}).then(function(v){var C=v.tempFilePath;return c?c.call(t,C,null):C}).catch(function(v){if(c)c.call(t,null,v);else throw v})}}var pt=function(t,e,r,i,a){var o,n,h;return o=Math.round(a.x-i.x),n=Math.round(a.y-i.y),h=Math.round(Math.sqrt(o*o+n*n)),t+.001*r*(h-e)};function gt(){var t=this;t.src&&(t.__oneTouchStart=function(e){t.touchX0=Math.round(e.x),t.touchY0=Math.round(e.y)},t.__oneTouchMove=function(e){var r,i;if(t.touchended)return t.updateCanvas();r=Math.round(e.x-t.touchX0),i=Math.round(e.y-t.touchY0);var a=Math.round(t.rectX+r),o=Math.round(t.rectY+i);t.outsideBound(a,o),t.updateCanvas()},t.__twoTouchStart=function(e,r){var i,a,o;t.touchX1=Math.round(t.rectX+t.scaleWidth/2),t.touchY1=Math.round(t.rectY+t.scaleHeight/2),i=Math.round(r.x-e.x),a=Math.round(r.y-e.y),o=Math.round(Math.sqrt(i*i+a*a)),t.oldDistance=o},t.__twoTouchMove=function(e,r){var i=t.oldScale,a=t.oldDistance,o=t.scale,n=t.zoom;t.newScale=pt(i,a,n,e,r),t.newScale<=1&&(t.newScale=1),t.newScale>=o&&(t.newScale=o),t.scaleWidth=Math.round(t.newScale*t.baseWidth),t.scaleHeight=Math.round(t.newScale*t.baseHeight);var h=Math.round(t.touchX1-t.scaleWidth/2),f=Math.round(t.touchY1-t.scaleHeight/2);t.outsideBound(h,f),t.updateCanvas()},t.__xtouchEnd=function(){t.oldScale=t.newScale,t.rectX=t.imgLeft,t.rectY=t.imgTop})}var vt={touchStart:function(e){var r=this,i=e.touches,a=i[0],o=i[1];r.src&&(M(r,!0,null,null),r.__oneTouchStart(a),e.touches.length>=2&&r.__twoTouchStart(a,o))},touchMove:function(e){var r=this,i=e.touches,a=i[0],o=i[1];r.src&&(M(r,null,!0),e.touches.length===1&&r.__oneTouchMove(a),e.touches.length>=2&&r.__twoTouchMove(a,o))},touchEnd:function(e){var r=this;r.src&&(M(r,!1,!1,!0),r.__xtouchEnd())}};function mt(){var t=this,e=t.width,r=t.height,i=t.cut,a=i.x;a===void 0&&(a=0);var o=i.y;o===void 0&&(o=0);var n=i.width;n===void 0&&(n=e);var h=i.height;h===void 0&&(h=r),t.outsideBound=function(f,l){t.imgLeft=f>=a?a:t.scaleWidth+f-a<=n?a+n-t.scaleWidth:f,t.imgTop=l>=o?o:t.scaleHeight+l-o<=h?o+h-t.scaleHeight:l},t.setBoundStyle=function(f){f===void 0&&(f={});var l=f.color;l===void 0&&(l="#04b00f");var m=f.mask;m===void 0&&(m="rgba(0, 0, 0, 0.3)");var u=f.lineWidth;u===void 0&&(u=1);var s=u/2,b=[{start:{x:a-s,y:o+10-s},step1:{x:a-s,y:o-s},step2:{x:a+10-s,y:o-s}},{start:{x:a-s,y:o+h-10+s},step1:{x:a-s,y:o+h+s},step2:{x:a+10-s,y:o+h+s}},{start:{x:a+n-10+s,y:o-s},step1:{x:a+n+s,y:o-s},step2:{x:a+n+s,y:o+10-s}},{start:{x:a+n+s,y:o+h-10+s},step1:{x:a+n+s,y:o+h+s},step2:{x:a+n-10+s,y:o+h+s}}];t.ctx.beginPath(),F(t,"fillStyle",m),t.ctx.fillRect(0,0,a,r),t.ctx.fillRect(a,0,n,o),t.ctx.fillRect(a,o+h,n,r-o-h),t.ctx.fillRect(a+n,0,e-a-n,r),t.ctx.fill(),b.forEach(function(c){t.ctx.beginPath(),F(t,"strokeStyle",l),F(t,"lineWidth",u),t.ctx.moveTo(c.start.x,c.start.y),t.ctx.lineTo(c.step1.x,c.step1.y),t.ctx.lineTo(c.step2.x,c.step2.y),t.ctx.stroke()})}}var xt="1.4.0",S=function(e){var r=this,i={};return O(r,B),Object.keys(B).forEach(function(a){i[a]=B[a].default}),Object.assign(r,i,e),r.prepare(),r.attachPage(),r.createCtx(),r.observer(),r.cutt(),r.methods(),r.init(),r.update(),r};return S.prototype.init=function(){var e=this,r=e.src;return e.version=xt,typeof e.onReady=="function"&&e.onReady(e.ctx,e),r?e.pushOrign(r):e.updateCanvas(),M(e,!1,!1,!1),e.oldScale=1,e.newScale=1,e},Object.assign(S.prototype,vt),S.prototype.prepare=tt,S.prototype.observer=rt,S.prototype.methods=lt,S.prototype.cutt=mt,S.prototype.update=gt,S})})($);var Ft=$.exports;const Bt=Lt(Ft);const kt={props:{boundStyle:{type:Object,default(){return{lineWidth:4,borderColor:"rgb(245, 245, 245)",mask:"rgba(0, 0, 0, 0.35)"}}}},data(){return{bottomNavHeight:50,originWidth:200,width:0,height:0,cropper:null,cropperOpt:{id:"cropper",targetId:"targetCropper",pixelRatio:1,width:0,height:0,scale:2.5,zoom:8,cut:{x:(this.width-this.originWidth)/2,y:(this.height-this.originWidth)/2,width:this.originWidth,height:this.originWidth},boundStyle:{lineWidth:It(this.boundStyle.lineWidth),mask:this.boundStyle.mask,color:this.boundStyle.borderColor}},destWidth:200,rectWidth:200,fileType:"jpg",src:""}},onLoad(g){const I=V();if(this.width=I.windowWidth,this.height=I.windowHeight-this.bottomNavHeight,this.cropperOpt.width=this.width,this.cropperOpt.height=this.height,this.cropperOpt.pixelRatio=I.pixelRatio,g.destWidth&&(this.destWidth=g.destWidth),g.rectWidth){const y=Number(g.rectWidth);this.cropperOpt.cut={x:(this.width-y)/2,y:(this.height-y)/2,width:y,height:y}}this.rectWidth=g.rectWidth,g.fileType&&(this.fileType=g.fileType),this.cropper=new Bt(this.cropperOpt).on("ready",()=>{}).on("beforeImageLoad",()=>{}).on("imageLoad",()=>{}).on("beforeDraw",()=>{}),St({frontColor:"#ffffff",backgroundColor:"#000000"}),U({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:y=>{this.src=y.tempFilePaths[0],this.cropper.pushOrign(this.src)}})},methods:{touchStart(g){this.cropper.touchStart(g)},touchMove(g){this.cropper.touchMove(g)},touchEnd(g){this.cropper.touchEnd(g)},getCropperImage(g=!1){if(!this.src)return _t({title:"请先选择图片再裁剪",icon:"none",duration:2e3});const I={destHeight:Number(this.destWidth),destWidth:Number(this.destWidth),fileType:this.fileType};this.cropper.getCropperImage(I,(y,_)=>{_?Wt({title:"温馨提示",content:_.message}):g?Mt({current:"",urls:[y]}):(Ot("uAvatarCropper",y),Ht.back())})},uploadTap(){const g=this;U({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:I=>{g.src=I.tempFilePaths[0],g.cropper.pushOrign(this.src)}})}}};function jt(g,I,y,_,w,W){const M=Pt,O=Rt;return Et(),At(O,{class:"content"},{default:L(()=>[R(O,{class:"cropper-wrapper",style:H({height:`${w.cropperOpt.height}px`})},{default:L(()=>[R(M,{id:"cropper",class:"cropper","disable-scroll":!0,style:H({width:w.cropperOpt.width,height:w.cropperOpt.height,backgroundColor:"rgba(0, 0, 0, 0.8)"}),"canvas-id":"cropper",onTouchstart:W.touchStart,onTouchmove:W.touchMove,onTouchend:W.touchEnd},null,8,["style","onTouchstart","onTouchmove","onTouchend"]),R(M,{id:"targetId",class:"cropper","disable-scroll":!0,style:H({position:"fixed",top:`-${w.cropperOpt.width*w.cropperOpt.pixelRatio}px`,left:`-${w.cropperOpt.height*w.cropperOpt.pixelRatio}px`,width:`${w.cropperOpt.width*w.cropperOpt.pixelRatio}px`,height:`${w.cropperOpt.height*w.cropperOpt.pixelRatio}`}),"canvas-id":"targetId"},null,8,["style"])]),_:1},8,["style"]),R(O,{class:"cropper-buttons safe-area-padding",style:H({height:`${w.bottomNavHeight}px`})},{default:L(()=>[R(O,{class:"upload",onClick:W.uploadTap},{default:L(()=>[q("选择图片")]),_:1},8,["onClick"]),R(O,{class:"getCropperImage",onClick:I[0]||(I[0]=D=>W.getCropperImage(!1))},{default:L(()=>[q("确定")]),_:1})]),_:1},8,["style"])]),_:1})}const Gt=Dt(kt,[["render",jt],["__scopeId","data-v-51f6c231"]]);export{Gt as default};
